
VizOutput:
  superclass: BaseDataClass
  items:
  - name: output_files_prefix
    type: str

  - name: species_list
    type: List[Species*]
    default: empty
    doc: Specifies a list of species to be visualized, when empty, all_species will be generated.
    TODO: | 
       This should be a list of BNGL patterns to be consistent with Counts, 
       but this feature is rarely used so for now those must be defined species.  
  
  - name: mode
    type: VizMode
    default: VizMode.ASCII
    
  - name: every_n_timesteps
    type: float
    default: 1
    doc: |
      Value is truncated (floored) to an integer.
      Value 0 means that the viz output is ran only once at iteration 0. 
    

CountTerm:
  superclass: BaseDataClass
  items:
  - name: species_pattern
    type: Complex*
    default: unset
    doc: |
      Count the number of molecules that match the given complex instance pattern.
      Counts each molecule exactly once. 
      If the pattern has a compartment set, this specifies the counted region.  
    
  - name: molecules_pattern
    type: Complex*
    default: unset
    doc: |
      Count the number of matches of the given pattern on molecules.
      The observable will count a molecule every time it matches the pattern.
      When the pattern is symmetric, e.g. as in A(a!1).A(a!1) then a 
      molecule A(a!1).A(a!1,b!2).B(a!2) will be counted twice because the 
      pattern may match in two different ways. 
      If the pattern has a compartment set, this specifies the counted region.  
    
  - name: reaction_rule
    type: ReactionRule*
    default: unset
    doc: |
      Count the number of reactions that occurred since the start of the simulation.
        
  - name: region
    type: Region*
    default: unset
    doc: | 
      Only a GeometryObject or SurfaceRegion can be passed as the region argument, 
      compound regions (created with +, -, *) are not supproted yet.   
      Cannot be set when 'species_pattern' or 'molecules_pattern' has a  
      compartment specified.
      If pattern compartment is not specified and 'region' is left 'unset', 
      counting is done in the whole world.
    
  - name: node_type
    type: ExprNodeType
    default: ExprNodeType.LEAF
    doc: Internal, used to represent an expression
    
  - name: left_node
    type: CountTerm*
    default: unset
    doc: Internal, when node_type is not Leaf, this is the left operand 

  - name: right_node
    type: CountTerm*
    default: unset
    doc: Internal, when node_type is not Leaf, this is the right operand 
    
  - name: initial_reactions_count
    type: uint64
    default: 0
    doc: | 
       Used for checkpointing, allows to set initial count of reactions that occurred.
       Ignored when molecules are counted.

  methods:
    # operator overloads follow the Python naming
    - name: __add__
      return_type: CountTerm*
      params:
      - name: op2
        type: CountTerm*
      
    - name: __sub__
      return_type: CountTerm*
      params:
      - name: op2
        type: CountTerm*
    
    
Count:
  superclass: CountTerm
  items:
  - name: name
    type: str
    default: unset
    doc: | 
       Name of a count may be specified when one needs to search for them later. 
       Also when the count is created while loading a BNGL file, its name is set.
       
  - name: file_name
    type: str
    default: unset
    doc: |
       File name with an optional path must be set. It is not deduced automatically.
    
  - name: count_expression 
    type: CountTerm*
    default: unset
    doc: | 
      The count expression must be composed only from CountTerm objects that are added or 
      subtracted.  

  - name: multiplier
    type: float
    default: 1
    doc: |
      In some cases it might be useful to multiply the whole count by a constant to get 
      for instance concentration. The count_expression is not an arbitrary expression
      and such multiplication can be done through this attribute.  
      
  - name: every_n_timesteps
    type: float
    default: 1
    doc: |
      Value is truncated (floored) to an integer.
      If value is set to 0, this Count is used only on-demand through calls to its
      get_current_value method.  
      
  methods:
  - name: get_current_value
    return_type: float
    doc: | 
       Returns the current value for this count. Cannot be used to count reactions.
       The model must be initialized with this Count present as one of the observables.
 
Observables:
  doc: |
    Neither VizOutput, nor Count have name, therefore there are no find_* methods.
    
  items:
  - name: viz_outputs
    type: List[VizOutput*]
    default: empty

  - name: counts
    type: List[Count*]
    default: empty
  
  methods:
  - name: add_viz_output
    params:
    - name: viz_output
      type: VizOutput*
  
  - name: add_count
    params:
    - name: count
      type: Count*
      
  - name: find_count  
    return_type: Count*
    params:
    - name: name
      type: str            
     
  - name: load_bngl_observables
    doc: | 
      Loads section observables from a BNGL file and creates Count objects according to it.
      All elementary molecule types used in the seed species section must be defined in subsystem.
    params:
    - name: file_name
      type: str   
      doc: BNGL file name.
           
    - name: subsystem
      type: Subsystem*

    - name: output_files_prefix
      type: str
      default: ""
      doc: Prefix to be used when creating files with observable values. 

    - name: parameter_overrides
      type: Dict[str, float]
      default: empty
     