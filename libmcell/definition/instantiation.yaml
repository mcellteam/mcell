
ReleasePattern:
  superclass: BaseDataClass
  items:
  - name: name
    type: str
    default: unset
    doc: Name of the release pattern
    
  - name: release_interval
    type: float
    default: TIME_INFINITY
    doc: | 
      During a train of releases, release molecules after every t seconds. 
      Default is to release only once.
    
  - name: train_duration
    type: float
    default: TIME_INFINITY
    doc: |
      The train of releases lasts for t seconds before turning off. 
      Default is to never turn off.
      
  - name: train_interval
    type: float
    default: TIME_INFINITY
    doc: |
      A new train of releases happens every t seconds. 
      Default is to never have a new train. 
      The train interval must not be shorter than the train duration.
  
  - name: number_of_trains
    type: int
    default: 1 
    doc: | 
      Repeat the release process for n trains of releases. Default is one train.
      For unlimited number of trains use constant NUMBER_OF_TRAINS_UNLIMITED.
    
    
MoleculeReleaseInfo:
  superclass: BaseDataClass
  items:
  - name: complex
    type: Complex*
    doc: | 
      Complex instance defining the molecule that will be released.
      Orientation of the complex instance is used to define orientation of the released molecule,
      when Orientation.DEFAULT is set, volume molecules are released with Orientation.NONE and
      surface molecules are released with Orientation.UP.
      Compartment must not be set because this specific release definition states the location.  
      
  - name: location
    type: List[float]
    doc: | 
      3D position where the molecule will be released. 
      If a molecule has a 2D diffusion constant, it will be
      placed on the surface closest to the coordinate given. 
      Argument must have exactly three floating point values.
        
    
ReleaseSite:
  superclass: BaseDataClass
  items:
  - name: name
    type: str
    doc: Name of the release site
      
  - name: complex
    type: Complex*
    default: unset 
    doc: | 
      Defines the species of the molecule that will be released. Not used for the LIST shape. 
      Must be set when molecule_list is empty and unset when molecule_list is not empty.
      Orientation of the complex instance is used to define orientation of the released molecule,
      when Orientation.DEFAULT is set, volume molecules are released with Orientation.NONE and
      surface molecules are released with Orientation.UP.
      When compartment is specified, this sets shape to Shape.COMPARTMENT and the molecules are released 
      into the compartment.

  - name: molecule_list
    type: List[MoleculeReleaseInfo*]
    default: empty
    doc: |
      Used for LIST shape release mode. 
      Only one of number_to_release, density, concentration or molecule_list can be set.

  - name: release_time
    type: float
    default: 0
    doc: | 
      Specifies time in seconds when the release event is executed.
      In case when a release pattern is used, this is the time of the first release.      
      Equivalent to MDL's RELEASE_PATTERN command DELAY.

  - name: release_pattern
    type: ReleasePattern*
    default: unset 
    doc: | 
      Use the release pattern to define schedule of releases. 
      The default is to release the specified number of molecules at the set release_time. 

  - name: shape
    type: Shape
    default: Shape.UNSET
    doc: |
      Set automatically when 
    
  - name: region
    type: Region*
    default: unset
    doc: Sets shape to Shape.REGION_EXPR. 

  - name: location
    type: List[float] # Vec3 and Vec2 are built-in data types
    default: unset # null is equivalent to None in YAML
    
  - name: site_diameter
    type: float
    default: 0
    doc: |
      For a geometrical release site, this releases molecules uniformly within
      a radius r. Not used for releases on regions.
      Usually required for Shape.List type of releases.
    
  # do we need radius when we have diameter?
  - name: site_radius
    type: float
    default: unset
    doc: |
      For a geometrical release site, this releases molecules uniformly within
      a radius r. Not used for releases on regions.

  - name: number_to_release
    type: float
    default: unset
    doc: | 
      Only one of number_to_release, density, concentration or molecule_list can be set.
      Value is truncated (floored) to an integer.

  - name: density
    type: float
    default: unset
    doc: |
       Unit is molecules per square micron (for surfaces).
       Only one of number_to_release, density, concentration or molecule_list can be set.
    
  - name: concentration
    type: float
    default: unset
    doc: |
       Unit is molar (moles per liter) for volumes.
       Only one of number_to_release, density, concentration or molecule_list can be set.

  - name: release_probability
    type: float
    default: unset


InitialSurfaceRelease:
  superclass: BaseDataClass
  doc: Defines molecules to be released onto a SurfaceRegion right when simulation starts
  items:
  - name: complex
    type: Complex*
  
  - name: number_to_release
    type: int
    default: unset
    doc: |
      Number of molecules to be released onto a region,
      only one of number_to_release and density can be set.
    
  - name: density
    type: float
    default: unset
    doc: |
      Density of molecules to be released onto a region,
      only one of number_to_release and density can be set.
      
      
Instantiation:
  items:
  - name: release_sites
    type: List[ReleaseSite*]
    default: empty
    
  - name: geometry_objects
    type: List[GeometryObject*]
    default: empty

  - name: checkpointed_molecules
    type: List[BaseChkptMol*]
    default: empty
    doc: Used when resuming simulation from a checkpoint.

  methods:
  - name: add_release_site
    doc: Makes a copy of the release site
    params:
    - name: s
      type: ReleaseSite*
      
  - name: find_release_site
    return_type: ReleaseSite*
    params:
    - name: name
      type: str
      
  - name: add_geometry_object
    doc: Makes a copy of the geometry object, in the future we will probably add some transformations
    params:
    - name: o
      type: GeometryObject*
      
  - name: find_geometry_object
    return_type: GeometryObject*
    params:
    - name: name
      type: str          
        
  - name: find_volume_compartment_object
    return_type: GeometryObject*
    params:
    - name: name
      type: str   

  - name: find_surface_compartment_object
    return_type: GeometryObject*
    params:
    - name: name
      type: str   
    
  - name: load_bngl_seed_species
    doc: | 
      Loads section seed species from a BNGL file and creates release sites according to it.
      All elementary molecule types used in the seed species section must be already defined in subsystem.
      If an item in the BNGL seed species section does not have its compartment set,
      the argument default_region must be set and the molecules are released into or onto the 
      default_region. 
    params:
    - name: file_name
      type: str  

    - name: default_release_region
      type: Region*
      default: unset
      doc: Used for seed species that have no compartments specified

#     - name: release_compartments
#       type: Dict[str, Region]
#       default: empty
#       doc: | 
#          When an empty dictionary is passed as this argument, compartments are created
#          automatically from the compartments definition.
#          When specified, compartments are not created automatically and when the seed species 
#          section is converted, this mapping sets the correspondence between the BNGL compartment
#          name and a GeometryObject name. All compartments used in the seed species section must be 
#          mapped to an existing geometry object. 
#          A 3D compartments must map onto a GeometryObject and represents the contents of this object.
#          A 2D compartments must map onto a SurfaceRegion or GeometryObject.  
      
    - name: parameter_overrides
      type: Dict[str, float]
      default: empty
